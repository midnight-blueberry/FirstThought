const fs = require('fs');

function loadFeature(path) {
  const content = fs.readFileSync(path, 'utf8');
  const scenarioTitles = [];
  const lines = content.split(/\r?\n/);
  for (const line of lines) {
    const m = line.match(/^\s*Scenario:\s*(.+)$/);
    if (m) scenarioTitles.push(m[1].trim());
  }
  return { scenarioTitles };
}

function defineFeature(feature, cb) {
  cb((title, steps) => {
    if (!feature.scenarioTitles.includes(title)) {
      throw new Error(`Scenario "${title}" not found in feature file`);
    }
    test(title, () => {
      steps({
        given: (_p, fn) => fn(),
        when: (_p, fn) => fn(),
        then: (_p, fn) => fn()
      });
    });
  });
}

module.exports = { loadFeature, defineFeature };
